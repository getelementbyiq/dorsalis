import { Box, IconButton } from "@mui/material";
import React, { useState, useRef, useEffect } from "react";

const CustomTextEditor = () => {
  const [content, setContent] = useState("");
  const editorRef = useRef(null);

  useEffect(() => {
    // Lade den gespeicherten Inhalt beim Start
    const savedContent = localStorage.getItem("editorContent");
    if (savedContent) {
      setContent(savedContent);
    }
  }, []);

  const handleContentChange = () => {
    if (editorRef.current) {
      const newContent = editorRef.current.innerHTML;
      setContent(newContent);
      localStorage.setItem("editorContent", newContent);
    }
  };

  const applyStyle = (style) => {
    document.execCommand(style, false, null);
  };
  const applyFormat = (format) => {
    document.execCommand("formatBlock", false, format);
  };

  return (
    <Box
      sx={{
        display: "flex",
        flexGrow: "1",
        position: "relative",
      }}
    >
      <Box
        sx={{
          display: "flex",
          flexDirection: "column",
          position: "absolute",
          right: "2px",
          top: "0px",
        }}
      >
        <IconButton onClick={() => applyStyle("bold")}>
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M5.33333 7.33333H8.33333C8.77536 7.33333 9.19928 7.15774 9.51184 6.84518C9.82441 6.53262 10 6.1087 10 5.66667C10 5.22464 9.82441 4.80072 9.51184 4.48816C9.19928 4.1756 8.77536 4 8.33333 4H5.33333V7.33333ZM12 10.3333C12 10.7273 11.9224 11.1174 11.7716 11.4814C11.6209 11.8454 11.3999 12.1761 11.1213 12.4547C10.8427 12.7332 10.512 12.9542 10.1481 13.105C9.78407 13.2557 9.39397 13.3333 9 13.3333H4.65C4.29101 13.3333 4 13.0423 4 12.6833V3.31667C4 2.95768 4.29101 2.66667 4.65 2.66667H8.33333C8.92064 2.66669 9.49502 2.8391 9.98525 3.16252C10.4755 3.48594 10.86 3.94613 11.0911 4.48605C11.3223 5.02596 11.3898 5.62184 11.2855 6.1998C11.1811 6.77775 10.9094 7.31236 10.504 7.73733C10.9591 8.00087 11.3369 8.37945 11.5995 8.8351C11.862 9.29075 12.0002 9.80744 12 10.3333ZM5.33333 8.66667V12H9C9.44203 12 9.86595 11.8244 10.1785 11.5118C10.4911 11.1993 10.6667 10.7754 10.6667 10.3333C10.6667 9.89131 10.4911 9.46738 10.1785 9.15482C9.86595 8.84226 9.44203 8.66667 9 8.66667H5.33333Z"
              fill="#52525B"
            />
          </svg>
        </IconButton>
        <IconButton onClick={() => applyStyle("italic")}>
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M5.99984 3.33333C5.99984 2.96514 6.29831 2.66667 6.6665 2.66667H12.6665C13.0347 2.66667 13.3332 2.96514 13.3332 3.33333C13.3332 3.70152 13.0347 4 12.6665 4H10.1566L7.23996 12H9.33317C9.70136 12 9.99984 12.2985 9.99984 12.6667C9.99984 13.0349 9.70136 13.3333 9.33317 13.3333H3.33317C2.96498 13.3333 2.6665 13.0349 2.6665 12.6667C2.6665 12.2985 2.96498 12 3.33317 12H5.84304L8.75971 4H6.6665C6.29831 4 5.99984 3.70152 5.99984 3.33333Z"
              fill="#52525B"
            />
          </svg>
        </IconButton>
        <IconButton onClick={() => applyStyle("underline")}>
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M5.3335 2.66667C5.3335 2.29848 5.03502 2 4.66683 2C4.29864 2 4.00016 2.29848 4.00016 2.66667V7.33333C4.00016 9.91066 4.66683 12 8.00016 12C11.3335 12 12.0002 9.91066 12.0002 7.33333V2.66667C12.0002 2.29848 11.7017 2 11.3335 2C10.9653 2 10.6668 2.29848 10.6668 2.66667V7.33333C10.6668 9.17428 10.6668 10.6667 8.00016 10.6667C5.3335 10.6667 5.3335 9.17428 5.3335 7.33333V2.66667Z"
              fill="#52525B"
            />
            <path
              d="M4.00016 12.6667C3.63197 12.6667 3.3335 12.9651 3.3335 13.3333C3.3335 13.7015 3.63197 14 4.00016 14H12.0002C12.3684 14 12.6668 13.7015 12.6668 13.3333C12.6668 12.9651 12.3684 12.6667 12.0002 12.6667H4.00016Z"
              fill="#52525B"
            />
          </svg>
        </IconButton>
        <IconButton onClick={() => applyStyle("strikeThrough")}>
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M11.436 9.33333C11.5893 9.67733 11.6667 10.06 11.6667 10.48C11.6667 11.3747 11.3173 12.0747 10.6193 12.578C9.92 13.0813 8.95533 13.3333 7.724 13.3333C6.75545 13.3333 5.7958 13.134 4.84458 12.7349C4.61803 12.6398 4.47733 12.4141 4.47733 12.1684C4.47733 11.6787 5.0125 11.3672 5.46962 11.543C6.16492 11.8103 6.87098 11.944 7.588 11.944C9.28867 11.944 10.1413 11.456 10.1473 10.4793C10.1508 10.2813 10.1144 10.0846 10.0402 9.901C9.96596 9.71738 9.85547 9.55062 9.71533 9.41067L9.63533 9.33267H2.66667C2.29848 9.33267 2 9.03419 2 8.666C2 8.29781 2.29848 7.99933 2.66667 7.99933H13.3333C13.7015 7.99933 14 8.29781 14 8.666C14 9.03419 13.7015 9.33267 13.3333 9.33267H11.436V9.33333ZM8.66083 7.31388C8.67151 7.31755 8.66886 7.33333 8.65758 7.33333H5.08987C5.08738 7.33333 5.08498 7.3324 5.08314 7.33072C4.96747 7.22495 4.86114 7.10939 4.76533 6.98533C4.47733 6.61333 4.33333 6.164 4.33333 5.63467C4.33333 4.81067 4.644 4.11 5.26467 3.53267C5.88667 2.95533 6.84733 2.66667 8.148 2.66667C9.00269 2.66667 9.82548 2.83276 10.6155 3.16496C10.8306 3.25541 10.9627 3.47067 10.9627 3.70402C10.9627 4.17314 10.448 4.47536 10.0021 4.3295C9.47449 4.15689 8.91783 4.07067 8.332 4.07067C6.67867 4.07067 5.85267 4.592 5.85267 5.63467C5.85267 5.91467 5.998 6.15867 6.28867 6.36733C6.57933 6.576 7.364 6.86733 7.364 6.86733L8.66083 7.31388Z"
              fill="#52525B"
            />
          </svg>
        </IconButton>
        <IconButton onClick={() => applyStyle("insertOrderedList")}>
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M4.35063 2.4329C4.54718 2.55437 4.66681 2.76895 4.66681 3L4.66667 6C4.66667 6.36819 4.36819 6.66667 4 6.66667C3.63181 6.66667 3.33333 6.36819 3.33333 6L3.33348 4.07869L2.96496 4.26295C2.63564 4.42761 2.23519 4.29413 2.07053 3.96481C1.90587 3.63549 2.03935 3.23504 2.36867 3.07039L3.702 2.40372C3.90866 2.30039 4.15409 2.31143 4.35063 2.4329ZM8.00016 4C7.63197 4 7.3335 4.29848 7.3335 4.66667C7.3335 5.03486 7.63197 5.33334 8.00016 5.33334H13.3335C13.7017 5.33334 14.0002 5.03486 14.0002 4.66667C14.0002 4.29848 13.7017 4 13.3335 4H8.00016ZM8 10.3333C7.63181 10.3333 7.33333 10.6318 7.33333 11C7.33333 11.3682 7.63181 11.6667 8 11.6667H13.3333C13.7015 11.6667 14 11.3682 14 11C14 10.6318 13.7015 10.3333 13.3333 10.3333H8Z"
              fill="#52525B"
            />
            <path
              d="M3.23954 10.1953L3.23879 10.1959L3.23791 10.1965L3.23659 10.1975L3.23593 10.198C2.94427 10.4191 2.52841 10.3637 2.30492 10.0731C2.08043 9.78131 2.13502 9.36274 2.42686 9.13825L2.46568 9.10965C2.48549 9.09552 2.51216 9.07707 2.54488 9.05578C2.60983 9.01352 2.70125 8.95834 2.81242 8.90307C3.02432 8.7977 3.35796 8.66667 3.74068 8.66667C4.62028 8.66667 5.33333 9.37973 5.33333 10.2593C5.33333 10.7696 5.03436 11.1614 4.76667 11.4523C4.56264 11.6741 4.31631 11.8547 4.1 12H4.83333C5.20152 12 5.5 12.2985 5.5 12.6667C5.5 13.0349 5.20152 13.3333 4.83333 13.3333H2.66667C2.29848 13.3333 2 13.0349 2 12.6667C2 12.1638 2.27564 11.8007 2.53333 11.5549C2.75167 11.3467 3.01384 11.1671 3.23119 11.0259L3.30187 10.9799C3.55833 10.8122 3.74012 10.6837 3.86355 10.5496C3.97086 10.4329 4 10.3489 4 10.2593C4 10.1161 3.8839 10 3.74068 10C3.64939 10 3.52936 10.0356 3.40609 10.0969C3.34967 10.125 3.30313 10.1532 3.27202 10.1734C3.2567 10.1834 3.24527 10.1912 3.23954 10.1953Z"
              fill="#52525B"
            />
          </svg>
        </IconButton>
        <IconButton onClick={() => applyStyle("insertUnorderedList")}>
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M5.33333 3.33334C5.33333 2.96515 5.63181 2.66667 6 2.66667H13.3333C13.7015 2.66667 14 2.96515 14 3.33334C14 3.70153 13.7015 4 13.3333 4H6C5.63181 4 5.33333 3.70153 5.33333 3.33334ZM2 3.33334C2 2.78105 2.44772 2.33334 3 2.33334C3.55228 2.33334 4 2.78105 4 3.33334C4 3.88562 3.55228 4.33334 3 4.33334C2.44772 4.33334 2 3.88562 2 3.33334ZM2 8C2 7.44772 2.44772 7 3 7C3.55228 7 4 7.44772 4 8C4 8.55229 3.55228 9 3 9C2.44772 9 2 8.55229 2 8ZM2 12.6667C2 12.1144 2.44772 11.6667 3 11.6667C3.55228 11.6667 4 12.1144 4 12.6667C4 13.219 3.55228 13.6667 3 13.6667C2.44772 13.6667 2 13.219 2 12.6667ZM5.33333 8C5.33333 7.63181 5.63181 7.33334 6 7.33334H13.3333C13.7015 7.33334 14 7.63181 14 8C14 8.36819 13.7015 8.66667 13.3333 8.66667H6C5.63181 8.66667 5.33333 8.36819 5.33333 8ZM5.33333 12.6667C5.33333 12.2985 5.63181 12 6 12H13.3333C13.7015 12 14 12.2985 14 12.6667C14 13.0349 13.7015 13.3333 13.3333 13.3333H6C5.63181 13.3333 5.33333 13.0349 5.33333 12.6667Z"
              fill="#52525B"
            />
          </svg>
        </IconButton>
      </Box>
      <Box
        sx={{
          display: "flex",
          gap: "2px",
          alignItems: "center",
          position: "absolute",
          left: "2px",
          top: "0px",
        }}
      >
        <IconButton onClick={() => applyFormat("<h1>")}>
          <svg
            width="16"
            height="17"
            viewBox="0 0 16 17"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M1.33937 0.805814C1.20223 0.66867 1.04223 0.600098 0.859367 0.600098C0.646031 0.600098 0.470791 0.66867 0.333646 0.805814C0.196502 0.942959 0.12793 1.11058 0.12793 1.30868V15.8917C0.12793 16.0898 0.188883 16.2574 0.310789 16.3946C0.447934 16.5317 0.623174 16.6003 0.836509 16.6003C1.01937 16.6003 1.17937 16.5317 1.31652 16.3946C1.4689 16.2574 1.55271 16.0898 1.56795 15.8917V9.0802H10.8481V15.8917C10.8481 16.0898 10.9166 16.2574 11.0538 16.3946C11.1909 16.5317 11.3585 16.6003 11.5566 16.6003C11.77 16.6003 11.9376 16.5317 12.0595 16.3946C12.1966 16.2574 12.2728 16.0898 12.2881 15.8917V1.30868C12.2881 1.11058 12.2195 0.942959 12.0824 0.805814C11.9604 0.66867 11.7928 0.600098 11.5795 0.600098C11.3814 0.600098 11.2062 0.66867 11.0538 0.805814C10.9166 0.942959 10.8481 1.11058 10.8481 1.30868V7.75447H1.56795V1.30868C1.56795 1.11058 1.49176 0.942959 1.33937 0.805814ZM14.6748 16.5267C14.7237 16.5756 14.7861 16.6001 14.862 16.6001C14.938 16.6001 15.0004 16.5756 15.0493 16.5267C15.0981 16.4777 15.1225 16.4206 15.1225 16.3554V11.1346C15.1225 11.0693 15.1035 11.0149 15.0655 10.9714C15.0276 10.9225 14.9733 10.8953 14.9027 10.8898C14.8756 10.8844 14.843 10.8844 14.8051 10.8898C14.7725 10.8953 14.7399 10.9089 14.7074 10.9306L13.348 11.8361C13.2612 11.885 13.2177 11.953 13.2177 12.04C13.2177 12.1053 13.2422 12.1651 13.291 12.2195C13.3453 12.2739 13.405 12.3011 13.4701 12.3011C13.5189 12.3011 13.5651 12.2848 13.6085 12.2521L14.6016 11.5862V16.3554C14.6016 16.4206 14.626 16.4777 14.6748 16.5267Z"
              fill="black"
            />
          </svg>
        </IconButton>
        <IconButton onClick={() => applyFormat("<h2>")}>
          <svg
            width="14"
            height="12"
            viewBox="0 0 14 12"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M0.896616 0.154286C0.795113 0.0514286 0.676692 0 0.541353 0C0.383459 0 0.253759 0.0514286 0.152256 0.154286C0.0507519 0.257143 0 0.382857 0 0.531429V11.4686C0 11.6171 0.0451129 11.7429 0.135338 11.8457C0.236842 11.9486 0.366541 12 0.524436 12C0.659774 12 0.778196 11.9486 0.879699 11.8457C0.992481 11.7429 1.05451 11.6171 1.06579 11.4686V6.36H7.93421V11.4686C7.93421 11.6171 7.98496 11.7429 8.08647 11.8457C8.18797 11.9486 8.31203 12 8.45865 12C8.61654 12 8.7406 11.9486 8.83083 11.8457C8.93233 11.7429 8.98872 11.6171 9 11.4686V0.531429C9 0.382857 8.94925 0.257143 8.84774 0.154286C8.75752 0.0514286 8.63346 0 8.47556 0C8.32895 0 8.19925 0.0514286 8.08647 0.154286C7.98496 0.257143 7.93421 0.382857 7.93421 0.531429V5.36571H1.06579V0.531429C1.06579 0.382857 1.0094 0.257143 0.896616 0.154286ZM13.9189 11.5859C13.8709 11.5352 13.8108 11.5099 13.7387 11.5099H10.9701L12.6306 9.76056C13.015 9.36056 13.3033 8.98873 13.4955 8.64507C13.6937 8.29577 13.7928 7.97465 13.7928 7.68169C13.7928 7.33803 13.7147 7.04225 13.5586 6.79437C13.4084 6.54084 13.1922 6.34648 12.9099 6.21127C12.6336 6.07042 12.3033 6 11.9189 6C11.6907 6 11.4565 6.04507 11.2162 6.13521C10.982 6.21972 10.7688 6.33521 10.5766 6.48169C10.3844 6.62817 10.2342 6.78873 10.1261 6.96338C10.0841 7.01408 10.0511 7.05915 10.027 7.09859C10.009 7.13803 10 7.17746 10 7.2169C10 7.27887 10.027 7.33239 10.0811 7.37746C10.1351 7.4169 10.1982 7.43662 10.2703 7.43662C10.3183 7.43662 10.3604 7.42535 10.3964 7.40282C10.4384 7.38028 10.4775 7.34085 10.5135 7.28451C10.5916 7.13239 10.6997 6.99718 10.8378 6.87887C10.982 6.76056 11.1441 6.66479 11.3243 6.59155C11.5105 6.51831 11.6967 6.48169 11.8829 6.48169C12.2913 6.48169 12.6156 6.59437 12.8559 6.81972C13.0961 7.04507 13.2162 7.34366 13.2162 7.71549C13.2162 7.94085 13.1321 8.19718 12.964 8.48451C12.8018 8.7662 12.5556 9.07606 12.2252 9.41408L10.1441 11.569C10.0961 11.6254 10.0721 11.6845 10.0721 11.7465C10.0721 11.831 10.0991 11.8958 10.1532 11.9408C10.2132 11.9803 10.2823 12 10.3604 12H13.7387C13.8108 12 13.8709 11.9775 13.9189 11.9324C13.973 11.8873 14 11.8282 14 11.7549C14 11.6873 13.973 11.631 13.9189 11.5859Z"
              fill="black"
            />
          </svg>
        </IconButton>
        <IconButton onClick={() => applyFormat("<h3>")}>
          <svg
            width="11"
            height="8"
            viewBox="0 0 11 8"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              fill-rule="evenodd"
              clip-rule="evenodd"
              d="M0.597744 0.102857C0.530075 0.0342857 0.451128 0 0.360902 0C0.255639 0 0.169173 0.0342857 0.101504 0.102857C0.0338346 0.171429 0 0.255238 0 0.354286V7.64571C0 7.74476 0.0300752 7.82857 0.0902256 7.89714C0.157895 7.96571 0.244361 8 0.349624 8C0.43985 8 0.518797 7.96571 0.586466 7.89714C0.661654 7.82857 0.703007 7.74476 0.710526 7.64571V4.24H5.28947V7.64571C5.28947 7.74476 5.32331 7.82857 5.39098 7.89714C5.45865 7.96571 5.54135 8 5.6391 8C5.74436 8 5.82707 7.96571 5.88722 7.89714C5.95489 7.82857 5.99248 7.74476 6 7.64571V0.354286C6 0.255238 5.96616 0.171429 5.8985 0.102857C5.83835 0.0342857 5.75564 0 5.65038 0C5.55263 0 5.46616 0.0342857 5.39098 0.102857C5.32331 0.171429 5.28947 0.255238 5.28947 0.354286V3.57714H0.710526V0.354286C0.710526 0.255238 0.672932 0.171429 0.597744 0.102857ZM7.48456 7.05532C7.45289 7.04397 7.42122 7.0383 7.38955 7.0383C7.30721 7.0383 7.23753 7.0695 7.18052 7.13191C7.12985 7.18865 7.10451 7.25106 7.10451 7.31915C7.10451 7.35319 7.11401 7.38723 7.13302 7.42128C7.15202 7.45532 7.18369 7.48936 7.22803 7.5234C7.41805 7.68227 7.63975 7.80142 7.89311 7.88085C8.14648 7.96028 8.40301 8 8.66271 8C9.09343 8 9.48614 7.91773 9.84086 7.75319C10.1956 7.58865 10.4774 7.35887 10.6865 7.06383C10.8955 6.76312 11 6.41418 11 6.01702C11 5.61418 10.9018 5.2766 10.7055 5.00426C10.5154 4.72624 10.2652 4.51347 9.95487 4.36596C9.65083 4.21844 9.32462 4.14468 8.97625 4.14468C8.96155 4.14468 8.94549 4.14529 8.92807 4.14651L10.658 2.45957C10.6896 2.42553 10.715 2.39433 10.734 2.36596C10.753 2.33191 10.7625 2.29787 10.7625 2.26383C10.7625 2.20709 10.7403 2.15035 10.696 2.09362C10.6516 2.03121 10.5756 2 10.4679 2H7.27553C7.19952 2 7.13302 2.0227 7.07601 2.06809C7.02534 2.11348 7 2.17021 7 2.2383C7 2.30638 7.02534 2.36596 7.07601 2.41702C7.13302 2.46241 7.19952 2.48511 7.27553 2.48511H9.90074L8.11164 4.22979C8.07997 4.2695 8.05463 4.30638 8.03563 4.34043C8.01663 4.36879 8.00713 4.40284 8.00713 4.44255C8.00713 4.51631 8.0293 4.57872 8.07363 4.62979C8.11797 4.67518 8.18131 4.69787 8.26366 4.69787C8.29533 4.69787 8.33967 4.6922 8.39668 4.68085C8.45368 4.6695 8.51386 4.66099 8.5772 4.65532C8.64687 4.64397 8.71655 4.6383 8.78622 4.6383C9.04592 4.6383 9.29929 4.68936 9.54632 4.79149C9.79968 4.88794 10.0055 5.0383 10.1639 5.24255C10.3286 5.44113 10.4109 5.70496 10.4109 6.03404C10.4109 6.3234 10.3349 6.58156 10.1829 6.80851C10.0309 7.02979 9.82502 7.20284 9.56532 7.32766C9.31196 7.45248 9.03009 7.51489 8.71972 7.51489C8.48535 7.51489 8.27633 7.48369 8.09264 7.42128C7.90895 7.35319 7.75059 7.25674 7.61758 7.13191C7.5669 7.0922 7.52257 7.06667 7.48456 7.05532Z"
              fill="black"
            />
          </svg>
        </IconButton>
      </Box>
      <Box
        ref={editorRef}
        contentEditable
        dangerouslySetInnerHTML={{ __html: content }}
        onInput={handleContentChange}
        style={{
          border: "1px solid #ccc",
          padding: "10px",
          minHeight: "200px",
          marginTop: "10px",
        }}
      />
    </Box>
  );
};

export default CustomTextEditor;
